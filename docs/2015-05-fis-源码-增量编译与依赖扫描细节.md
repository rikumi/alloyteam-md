---
title: FIS 源码 - 增量编译与依赖扫描细节
date: 2015-05-11
author: TAT.casperchen
source_link: http://www.alloyteam.com/2015/05/fis%e6%ba%90%e7%a0%81-%e5%a2%9e%e9%87%8f%e7%bc%96%e8%af%91%e4%b8%8e%e4%be%9d%e8%b5%96%e6%89%ab%e6%8f%8f%e7%bb%86%e8%8a%82/
---

<!-- {% raw %} - for jekyll -->

前面已经提到了 `fis release` 命令大致的运行流程。本文会进一步讲解增量编译以及依赖扫描的一些细节。

首先，在 `fis release` 后加上`--watch` 参数，看下会有什么样的变化。打开命令行

    fis release --watch
     

不难猜想，内部同样是调用 `release()`方法把源文件编译一遍。区别在于，进程会监听项目路径下源文件的变化，一旦出现文件（夹）的增、删、改，则重新调用 `release()`进行增量编译。

并且，如果资源之间存在依赖关系（比如资源内嵌），那么一些情况下，被依赖资源的变化，会反过来导致资源引用方的重新编译。

```html
<span class="comment">// 是否自动重新编译</span>
<span class="keyword">if</span>(options.watch){
    watch(options); <span class="comment">// 对！就是这里</span>
} <span class="keyword">else</span> {
    release(options);
}
 
```

下面扒扒源码来验证下我们的猜想。

## watch (opt) 细节

源码不算长，逻辑也比较清晰，这里就不上伪代码了，直接贴源码出来，附上一些注释，应该不难理解，无非就是重复**文件变化–>release (opt)**这个过程。

在下一小结稍稍展开下增量编译的细节。

```html
<span class="keyword">function</span> watch(o
```


<!-- {% endraw %} - for jekyll -->