---
title: 印记中文推出文档 CDN + COS 部署方案
date: 2017-08-30
author: TAT.heyli
source_link: http://www.alloyteam.com/2017/08/13078/
---

<!-- {% raw %} - for jekyll -->

![](https://user-gold-cdn.xitu.io/2017/8/30/abcc1401a5e1d72e199cf7f4a4009133)

## 简介

印记中文的成立主要是为了协助社区更好地翻译与部署文档。最近联合腾讯云一起设计了一套有效提升访问速度及降低流量消耗成本的方案，即 COS 对象存储服务 及 CDN 加速方案。本文主要描述方案大体的实现过程，如果你是技术文档的管理者，苦于没有优秀的文档部署方案，可以联系印记中文 (docschina)，我们会提供接入服务。如果你遇到性能问题，我们也可以提供免费的技术咨询服务

\*\* QQ 群：492361223 \*\*

也可以关注我们的公众号：

![](https://user-gold-cdn.xitu.io/2017/8/30/9493c59f8c533bba597398bdcb84e2f6)

官网：[docschina.org](https://docschina.org/)

## 代码存放及 CI 构建

一般而言，对公有代码，一般采用 Github + Travis-CI 存放及构建方式。而对于私有代码来说，则会直接使用 Bitbucket + Pipeline (Bitbucket 自有的构建服务)。**（点击以下标题展开详细内容）**

Github + Travis-CI

自动构建与部署服务的架构如下图：

![Sample process](https://user-gold-cdn.xitu.io/2017/8/30/deb91a048ddd393ef496c73fb78f327a)

在代码仓库方面，我们需要两个分支，一个是 `master` 分支，用于存放文档源码，另一个是 `gh-pages` 分支，用于存放生成的文档文件。

然后，我们需要配置 `.travis.yml` 文件，用于 Travis-CI 构建和部署我们的项目，下面是求全配置，表示仅在在 `master` 分支有 `push` 或者 `pull request` 事件的时候，才会触发构建，使用语言是 `node.js`，版本是 `6.x`，首先运行完安装依赖的 `npm install` 之后，再运行 `bash ./scripts/deploy.sh`。

    branches:
      only:
        - master
    language: node_js
    node_js:
      - "6"
    script:
      - bash ./scripts/deploy.sh
    sudo: required
    install:
      - npm install
     

那么 `./scripts/deploy.sh` 脚本中，主要就是承担构建、鉴权，以及代码推送的功能。

    // deploy.sh 第一部份，用于构建代码
    npm run dist
     

```ruby
// deploy.sh 第二部份，用于与github鉴权
REPO=`git config remote.origin.url`
SSH_REPO=${REPO}
git config --global user.name "Travis CI"
git config --global user.email "ci@travis-ci.org"
git remote set-url origin "${SSH_REPO}"
 
openssl aes-256-cbc -K $encrypted_7562052d3e34_key -iv $encrypted_7562052d3e34_iv -in scripts/deploy_key.enc -out scripts/deploy_key -d
chmod 600 scripts/deploy_key
eval `ssh-agent -s`
ssh-add scripts/deploy_key<
```


<!-- {% endraw %} - for jekyll -->