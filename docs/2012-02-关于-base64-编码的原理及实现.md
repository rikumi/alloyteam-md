---
title: 关于 base64 编码的原理及实现
date: 2012-02-09
author: TAT.岑安
source_link: http://www.alloyteam.com/2012/02/%e5%85%b3%e4%ba%8ebase64%e7%bc%96%e7%a0%81%e7%9a%84%e5%8e%9f%e7%90%86%e5%8f%8a%e5%ae%9e%e7%8e%b0/
---

<!-- {% raw %} - for jekyll -->

我们的图片大部分都是可以转换成 base64 编码的 data：image。 这个在将 canvas 保存为 img 的时候尤其有用。虽然除 ie 外，大部分现代浏览器都已经支持原生的基于 base64 的 encode 和 decode，例如 btoa 和 atob。（将 canvas 画布保存成 img 并强制改变 mimetype 进行下载，会在下一篇记录）

但是处于好奇心，还是驱使我去了解下 base64 编码的原理。以便也在不支持原生 base64 编码的 ie 下可以得以实现。  

【Base64】  
-base64 的编码都是按字符串长度，以每 3 个 8bit 的字符为一组，  
-然后针对每组，首先获取每个字符的 ASCII 编码，  
-然后将 ASCII 编码转换成 8bit 的二进制，得到一组 3\*8=24bit 的字节  
-然后再将这 24bit 划分为 4 个 6bit 的字节，并在每个 6bit 的字节前面都填两个高位 0，得到 4 个 8bit 的字节  
-然后将这 4 个 8bit 的字节转换成 10 进制，对照 Base64 编码表（下表），得到对应编码后的字符。

（注：1. 要求被编码字符是 8bit 的，所以须在 ASCII 编码范围内，\\u0000-\\u00ff，中文就不行。  
2. 如果被编码字符长度不是 3 的倍数的时候，则都用 0 代替，对应的输出字符为 =）

| **Base64 编码表** |      |    |       |      |   |       |      |   |       |      |
| -------------- | ---- | -- | ----- | ---- | - | ----- | ---- | - | ----- | ---- |
| Value          | Char |    | Value | Char |   | Value | Char |   | Value | Char |
| 0              | A    | 16 | Q     | 32   | g | 48    | w    |   |       |      |
| 1              | B    | 17 | R     | 33   | h | 49    | x    |   |       |      |
| 2              | C    | 18 | S     | 34   | i | 50    | y    |   |       |      |
| 3              | D    | 19 | T     | 35   | j | 51    | z    |   |       |      |
| 4              | E    | 20 | U     | 36   | k | 52    | 0    |   |       |      |
| 5              | F    | 21 | V     | 37   | l | 53    | 1    |   |       |      |
| 6              | G    | 22 | W     | 38   | m | 54    | 2    |   |       |      |
| 7              | H    | 23 | X     | 39   | n | 55    | 3    |   |       |      |
| 8              | I    | 24 | Y     | 40   | o | 56    | 4    |   |       |      |
| 9              | J    | 25 | Z     | 41   | p | 57    | 5    |   |       |      |
| 10             | K    | 26 | a     | 42   | q | 58    | 6    |   |       |      |
| 11             | L    | 27 | b     | 43   | r | 59    | 7    |   |       |      |
| 12             | M    | 28 | c     | 44   | s | 60    | 8    |   |       |      |
| 13             | N    | 29 | d     | 45   | t | 61    | 9    |   |       |      |
| 14             | O    | 30 | e     | 46   | u | 62    | +    |   |       |      |
| 15             | P    | 31 | f     | 47   | v | 63    | /    |   |       |      |

比如举下面 2 个例子：  
a) 字符长度为能被 3 整除时：比如 “Tom” ：

                T           o           m
    ASCII:      84          111         109
    8bit字节:   01010100    01101111    01101101
    6bit字节:     010101      000110      111101      101101
    十进制:     21          6           61          45
    对应编码:   V           G           9           t

所以，btoa ('Tom') = VG9t

b) 字符串长度不能被 3 整除时，比如 “Lucy”：

                L           u           c           y
    ASCII:      76          117         99          121
    8bit字节:   01001100    01110101    01100011    01111001      00000000    00000000
    6bit字节:     010011      000111      010101      100011      011110  010000  000000  000000
    十进制:     19          7           21          35             30      16      (异常) (异常)
    对应编码:   T           H           


<!-- {% endraw %} - for jekyll -->