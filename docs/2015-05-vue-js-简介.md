---
title: Vue.js 简介
date: 2015-05-24
author: TAT.helondeng
source_link: http://www.alloyteam.com/2015/05/vue-js%e7%ae%80%e4%bb%8b/
---

<!-- {% raw %} - for jekyll -->

Vue.js 是一个基于 `MVVM` 模型的 web 库。通过双向数据绑定连接 View 和 Model 层。实际的 DOM 操作被封装成 `Directives` 和 `Filters`。

### 基本定义

每个 Vue 对象的实例是一个 ViewModel。创建方式：

```html
&lt;span class="keyword">var&lt;/span> vue = &lt;span class="keyword">new&lt;/span> Vue({
    el: view,
    data: model
});
 
```

其中 `vue.$el` 用于管理 View 层上的 DOM 。而 `vue.$data` 用于管理 Model 层的数据，可以通过 `vue.$data.property` 访问 Model 层数据，也可以直接 `vue.property` 访问。

### Hello World 入门

```html
&lt;div id=&lt;span class="string">"example"&lt;/span>>
    &lt;h1>{{ title }}&lt;/h1>
    &lt;ul>
        &lt;li v-repeat=&lt;span class="string">'todo:todoList'&lt;/span>>{{ todo | uppercase }}&lt;/li>
    &lt;/ul>
&lt;/div>
&lt;span class="comment">// 对应 js&lt;/span>
&lt;span class="keyword">var&lt;/span> demo = &lt;span class="keyword">new&lt;/span> Vue({
    el: &lt;span class="string">'#example'&lt;/span>,
    data: {
        title: &lt;span class="string">'todo list'&lt;/span>,
        todoList: [&lt;span class="string">'do work'&lt;/span>, &lt;span class="string">'read book'&lt;/span>, &lt;span class="string">'shopping'&lt;/span>]
    }
});
 
```

从上面的例子可以看出：

-   模版替换使用的是 `{{ variable }}`
-   Directives 格式是 `v-xxx` ，如上 v-repeat 。
-   Filtrs 格式是 `{{ variable | filter }}` ，如上 uppercase

### 事件

在 DOM 节点上通过 `v-on` 绑定处理函数（可以是表达式）。函数的第一个参数是 DOM Event 对象，该对象附带 `targetVM` 指向 DOM 对应的 ViewModel。

```html
&lt;div id=&lt;span class="string">"example"&lt;/span> v-on=&lt;span class="string">"click : clickHandler"&lt;/span>>&lt;/div>
&lt;span class="keyword">var&lt;/span> vue = &lt;span class="keyword">new&lt;/span> Vue({
    el: &lt;span class="string">'#example'&lt;/span>,
    data: {},
    methods: {
        clickHandler: &lt;span class="keyword">function&lt;/span>(e){
            console.log(e.targetVM); &lt;span class="comment">// 指向vue对象，可以理解为this。&lt;/span>
        }
    }
});
 
```

### 自定义指令

内置的指令不够用怎么办？想自定义数据变化对 DOM 的影响怎么破？  
Vue.js 允许自定义全局指令，格式：

```html
Vue.directive(id, {
    bind: &lt;span class="keyword">function&lt;/span>(){
    &lt;span class="comment">// 仅在初始化绑定元素时调用&lt;/span>
    },
    update: &lt;span class="keyword">function&lt;/span>(newVal, oldVal){
    &lt;span class="comment">// 初始化时调用一次，以后每次数据变化，就被调用&lt;/span>
    },
    unbind: &lt;span class="keyword">function&lt;/span>(){
    &lt;span class="comment">// 仅在指令解绑时被调用&lt;/span>
    }
});
 
```

同时，在指令函数中，提供了一些 `this` 上下文的公开属性（这里列举了几个常用的）：

-   `el` : 访问绑定的 DOM 元素，提供 View 层访问。
-   `vm` : 访问指令对应的上下文，ViewModel 对象，`this.vm.$el = this.el`
-   `expression` : 指令绑定的表达式，不包括参数和 filter
-   `args` : 参数

举个栗子。

```html
&lt;div id=&lt;span class="string">"example"&lt;/span> v-demo=&lt;span class="string">"args: message"&lt;/span> v-on=&lt;span class="string">"click: onClick"&lt;/span>>&lt;/div>
Vue.directive(&lt;span class="string">'demo'&lt;/span>, {
    acceptStatement: &lt;span class="keyword">true&lt;/span>,
    bind: &lt;span class="keyword">function&lt;/span>(){
        &lt;span class="keyword">this&lt;/span>.el.style.cssText = &lt;span class="string">'color: red; background: #666;'&lt;/span>;
    },
    update: &lt;span class="keyword">function&lt;/span>(newVal, oldVal){
        &lt;span class="keyword">this&lt;/span>.el.innerHTML = &lt;span class="string">'name = '&lt;/span> + &lt;span class="keyword">this&lt;/span>.name + &lt;span class="string">'&lt;br/>'&lt;/span> + 
            &lt;span class="string">'arg = '&lt;/span> + &lt;span class="keyword">this&lt;/span>.arg + &lt;span class="string">'&lt;br/>'&lt;/span> + 
            &lt;span class="string">'expression = '&lt;/span> + &lt;span class="keyword">this&lt;/span>.expression + &lt;span class="string">'&lt;br/>'&lt;/span>;
        console.log(&lt;span class="keyword">this&lt;/span>.vm.&lt;span class="variable">$data&lt;/span>);
        console.log(&lt;span class="keyword">this&lt;/span>.el === &lt;span class="keyword">this&lt;/span>.vm.&lt;span class="variable">$el&lt;/span>);
    }
});
&lt;span class="keyword">var&lt;/span> demo = &lt;span class="keyword">new&lt;/span> Vue({
    el: &lt;span class="string">'#example'&lt;/span>,
    data: {
        message: &lt;span class="string">'hello world!'&lt;/span>
    },
    methods: {
        onClick: &lt;span class="keyword">function&lt;/span>(){
            &lt;span class="comment">// custom directive update will be called.&lt;/span>
            &lt;span class="keyword">this&lt;/span>.&lt;span class="variable">$data&lt;/span>.message = &lt;span class="string">'hahaha!'&lt;/span>;
        }
    }
});
 
```

### 自定义过滤器

Vue.js 允许使用全局函数 `Vue.filter()` 定义过滤器，将 Model 数据输出到 View 层之前进行数据转化。

```html
Vue.filter(id, &lt;span class="keyword">function&lt;/span>(){});
 
```

双向过滤器允许 View 层数据（input 元素）变回写到 Model 层之前，进行转化，定义方式如下：

```html
Vue.filter(id, {
    read: &lt;span class="keyword">function&lt;/span>(val){},
    write: &lt;span class="keyword">function&lt;/span>(newVal, oldVal){}
});
 
```

举个栗子：

```html
&lt;div id=&lt;span class="string">"example"&lt;/span>>
    &lt;p>{{ message }}&lt;/p>
    &lt;input type=&lt;span class="string">'text'&lt;/span> v-model=&lt;span class="string">"message | twoWays"&lt;/span>>&lt;/div>
&lt;/div>
Vue.filter(&lt;span class="string">'twoWays'&lt;/span>, {
    read: &lt;span class="keyword">function&lt;/span>(val){
        &lt;span class="keyword">return&lt;/span> &lt;span class="string">'read '&lt;/span> + val;
    },
    write: &lt;span class="keyword">function&lt;/span>(newVal, oldVal){
        console.log(newVal, oldVal);
        &lt;span class="keyword">return&lt;/span> ov + &lt;span class="string">' write'&lt;/span>;
    }
});
 
&lt;span class="keyword">var&lt;/span> demo = &lt;span class="keyword">new&lt;/span> Vue({
    el: &lt;span class="string">'#example'&lt;/span>,
    data: {
        message: &lt;span class="string">'hello'&lt;/span>
    }
});
 
```

### 总结

Vue.js 提供的核心是 MVVM 中的 VM，确保视图和数据的一致性。同时，借鉴了 Angular 中的 Directive 和 Filter 的概念，但是却简化了 API。


<!-- {% endraw %} - for jekyll -->