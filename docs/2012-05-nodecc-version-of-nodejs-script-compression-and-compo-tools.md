---
title: ã€NodeCCã€‘NodeJs å¼€å‘çš„è„šæœ¬å‹ç¼©å’Œ combo å·¥å…·
date: 2012-05-28
author: TAT.å²‘å®‰
source_link: http://www.alloyteam.com/2012/05/nodecc-version-of-nodejs-script-compression-and-compo-tools/
---

å¯¹äº Web å‰ç«¯çš„å¼€å‘è€Œè¨€ï¼Œä¸ºäº†é™ä½æ–‡ä»¶å¤§å°ï¼Œjs æ–‡ä»¶å’Œ css æ–‡ä»¶çš„å‹ç¼©å’Œç»„åˆå‡ ä¹æ˜¯é»˜è®¤çš„è§„çŸ©ã€‚

æˆ‘ä»¬åˆ©ç”¨ YUI Compressor å’Œ google Compiler å¯ä»¥å¾ˆå®¹æ˜“çš„å®Œæˆæ–‡ä»¶çš„å‹ç¼©ã€‚ ç”šè‡³ yui compressor æœ¬èº«éƒ½å·²ç»æ”¯æŒ å¤šæ–‡ä»¶çš„æ‰¹é‡å‹ç¼©ã€‚

ä½†æ˜¯ï¼Œä¸ºäº†æ›´å¥½çš„å¤„ç†è¿™äº›æœºæ¢°åŒ–çš„äº‹æƒ…ï¼Œæˆ‘ä»¬é€šå¸¸è¿˜æ˜¯éœ€è¦è„šæœ¬æ¥è¾…åŠ©ï¼Œè®©è¿™äº›å·¥ä½œå¯ä»¥æ›´å¥½çš„è‡ªåŠ¨åŒ–ï¼Œå¯é…ç½®åŒ–ã€‚

ç½‘ä¸Šæœ‰å¾ˆå¤šç±»ä¼¼çš„è„šæœ¬å·¥å…·ï¼Œæˆ–è€…æœ‰çš„ä¹Ÿå·²ç»ç¼–è¯‘æˆäº†å¯è§†åŒ–çš„å·¥å…·æ¥ä½¿ç”¨ã€‚

æˆ‘è‡ªå·±ä»¥å‰ä¹Ÿå†™è¿‡ python ç‰ˆæœ¬çš„ï¼Œä¹Ÿç”¨è¿‡åŒäº‹å†™çš„ç±»ä¼¼çš„è„šæœ¬ï¼ŒåŸºæœ¬ä¹Ÿéƒ½æ˜¯ python ç‰ˆæœ¬çš„ã€‚é‰´äºå¤§å¤šæ•°å‰ç«¯çš„æ”»åŸå¸ˆä»¬å¯¹ js æ›´ä¸ºç†Ÿæ‚‰ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œä¹Ÿæä¾›ä¸€ä¸ªç®€æ˜“çš„ nodejs ç‰ˆæœ¬çš„ã€‚ä¸‹åˆèŠ±äº† 3 ä¸ªå°æ—¶å†™çš„ã€‚

**NodeCC --> Node Compressor and Comboer**

ä»£ç å¾ˆç®€å•ï¼ŒåŸºæœ¬å°±æ˜¯è¯»æ–‡ä»¶ï¼Œå†™æ–‡ä»¶ï¼Œè°ƒç”¨ç³»ç»Ÿ jar å‘½ä»¤ ä½¿ç”¨ yuicompressor å‹ç¼©æ–‡ä»¶ã€‚  
æºç æ‰˜ç®¡åœ¨ï¼š[github.com/hongru/nodeCC](https://github.com/hongru/nodeCC) ä¸Šï¼Œ100 è¡Œå·¦å³ã€‚

**ç¼–ç ä¸­éœ€è¦æ³¨æ„çš„å‡ ä¸ªåœ°æ–¹ï¼š**

-   nodejs ä¸­ fileSystem buffer çš„æ¦‚å¿µï¼Œç®€å•çš„å¯ä»¥ç†è§£æˆæ–‡æœ¬æ•°æ®æµï¼Œæ‰€ä»¥ï¼Œä¸ºäº†å¾—åˆ°æˆ‘ä»¬å¸¸è§çš„æ–‡æœ¬ï¼Œæ³¨æ„ readFile å toString çš„ä½¿ç”¨ã€‚
-   ç”Ÿæˆæ–°æ–‡ä»¶æ—¶ï¼Œè·¯å¾„æ˜¯å¦å­˜åœ¨çš„åˆ¤æ–­ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œç”ŸæˆæŒ‡å®šç›®å½•æ—¶ï¼Œç”±äº node æœ¬èº«çš„ mkdir ä¸æ”¯æŒå¤šçº§ç›®å½•ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦è‡ªå·±æ¥å¤„ç†å¤šçº§ç›®å½•çš„é€’å½’ç”Ÿæˆã€‚  
    æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯åˆ©ç”¨ child_process åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ mkdir -p.  
    å¦ä¸€ç§å°±æ˜¯åˆ†æè·¯å¾„ï¼Œä¸€çº§ä¸€çº§é€’å½’åˆ›å»ºç›®å½•ã€‚ä»£ç å‚è€ƒ <https://gist.github.com/2817910>  

    ```javascript
    /* mkdir -p for node */
    var fs = require("fs"),
        path = require("path");
    function mkdirpSync(pathes, mode) {
        mode = mode || 0777;
        var dirs = pathes.trim().split("/");
        if (dirs[0] == ".") {
            // ./aaa
            dirs.shift();
        }
        if (dirs[0] == "..") {
            // ../aaa
            dirs.splice(0, 2, dirs[0] + "/" + dirs[1]);
        }
        dirs.length && mkdir(dirs.shift()); // mkdir
        function mkdir(d) {
            if (!path.existsSync(d)) {
                fs.mkdirSync(d, mode);
            }
            dirs.length && mkdir(d + "/" + dirs.shift());
        }
    }
    // eg
    //mkdirpSync('hongru/me');
    ```
-   é€šè¿‡ child_process çš„ spawn æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ï¼Œæ¯”å¦‚ lsï¼Œ java ç­‰ã€‚ç„¶åé€šè¿‡ stdout å’Œ stderr æ¥ç›‘å¬è·å¾— å‘½ä»¤æ‰€è¿”å›çš„ log æˆ–è€… error ä¿¡æ¯ã€‚

ã€ä½¿ç”¨æ–¹æ³•ã€‘

1.  å½“ç„¶ï¼Œå› ä¸ºæ˜¯ nodejs ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥è‡ªç„¶éœ€è¦å®‰è£… nodejsï¼Œå®˜æ–¹æœ‰æä¾›è¯¦ç»†è¯´æ˜
2.  å› ä¸ºç”¨äº† jar åŒ… yuicompressor.jarï¼Œ æ‰€ä»¥ï¼Œéœ€è¦å®‰è£… JAVA çš„ sdkï¼Œå®‰è£…è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ï¼Œä¸ä¼šçš„æœä¸€ä¸‹å³å¯ã€‚
3.  æœ€åï¼Œå…³äº config.json æ–‡ä»¶çš„é…ç½®ï¼Œå¾ˆç®€å•ï¼Œéƒ½æ˜¯ä¸¤ä¸ªå­—æ®µï¼Œâ€œsourceâ€ å’Œ â€œtargetâ€ï¼Œsource ä»£è¡¨æºè·¯å¾„æ–‡ä»¶ï¼Œtarget è¡¨ç¤ºå‹ç¼©ä¹‹åç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„ã€‚  
    æ”¯æŒç›®å½•çº§åˆ«ã€‚  
    å¦å¤–ï¼Œå¦‚æœ source å­—æ®µä¸ºä¸€ä¸ªæ•°ç»„çš„è¯ï¼Œä¼šå°†è¿™ä¸ªæ•°ç»„é‡Œé¢çš„æ–‡ä»¶æŒ‰ç…§é¡ºåºåˆå¹¶ï¼Œç„¶åå‹ç¼©ç”Ÿæˆåˆ°æŒ‡å®š target çš„è·¯å¾„ã€‚æ‰€ä»¥ï¼Œconfig.json çœ‹èµ·æ¥ä¼šåƒæ˜¯è¿™ä¸ªæ ·å­ï¼š  

    ```javascript
    {
    Â Â Â Â "css-test": {
    Â Â Â Â Â Â Â Â "source": "test/css/",
    Â Â Â Â Â Â Â Â "target": "test/public/css/"
    Â Â Â Â },
    Â Â Â Â "normal-file-compress": {
    Â Â Â Â Â Â Â Â "source": "test/test.js",
    Â Â Â Â Â Â Â Â "target": "test/test.min.js"
    Â Â Â Â },
    Â Â Â Â "normal-dir-compress": {
    Â Â Â Â Â Â Â Â "source": "test/js/",
    Â Â Â Â Â Â Â Â "target": "test/public/js/"
    Â Â Â Â },
    Â Â Â Â "compress-and-merge": {
    Â Â Â Â Â Â Â Â "source": [
    Â Â Â Â Â Â Â Â Â Â Â Â "test/js/a.js",
    Â Â Â Â Â Â Â Â Â Â Â Â "test/js/b.js"
    Â Â Â Â Â Â Â Â ],
    Â Â Â Â Â Â Â Â "target": "test/public/js/ab.js"
    Â Â Â Â }
    }
    ```
4.  å°†å¸¦æœ‰ yuicompressor.jar çš„ tools/ , ä¸»è„šæœ¬ nodecc.js, ä»¥åŠé…ç½®å¥½çš„ config.json æ”¾ç½®åœ¨åŒä¸€ç›®å½•ä¸‹ï¼Œç„¶åæ‰§è¡Œ  

        node nodecc.js

    å³å¯ã€‚

å¥½äº†ï¼Œå·¥å…·å¾ˆç®€å•ï¼Œä»£ç ä¹Ÿå¾ˆç®€å•ï¼Œå¸Œæœ›èƒ½ç»™æœ‰éœ€è¦çš„åŒå­¦æä¾›ä¸€ç‚¹ç‚¹å¸®åŠ© ğŸ™‚